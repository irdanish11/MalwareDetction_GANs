# -*- coding: utf-8 -*-
"""
Created on Sat Sep  5 01:36:35 2020

@author: Danish
"""


from DataPrepration import Get_Data
from SvmClassifier import SVMClassifier, load_model
from scipy.sparse import vstack
import numpy as np


pathX = 'drebin-features/drebin-parrot-v2-down-features-X.json'
pathY = 'drebin-features/drebin-parrot-v2-down-features-Y.json'

X, Y = Get_Data(pathX, pathY, test_size=0.25)

path='./checkpoints/'
name='SVM.obj'

################## Train Model ##################
svm = SVMClassifier(C=1.0, path=path, name=name, svc_linear=True, weight=None)
clf = svm.fit_svm_clf(X, Y)


################## Evaluate Model ##################
labels= {0:'Goodware', 1:'Malware'}
ckpt_path = path+name
svm = load_model(ckpt_path)

#Loaing Test Data
malware_train_test = Get_Data(pathX, pathY)
goodware_train_test = Get_Data(pathX, pathY)

#Aranging test Data
X_test = vstack([goodware_train_test[1],malware_train_test[1]])
Y_test = np.concatenate((goodware_train_test[3],malware_train_test[3]))
print('Sahpe of X_test: '+str(X_test.shape))
print('Sahpe of Y_test: '+str(Y_test.shape))

acc = svm.visualize_evaluation(X_test, Y_test, labels, path='./SVM_ConfusionMatrix.png', normalize='all')

#Get Predictions
Y_pred = svm.predict(X_test)


